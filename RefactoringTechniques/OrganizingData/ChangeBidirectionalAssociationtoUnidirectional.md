# 重构：将双向关联改为单向关联

## 问题

两个类之间存在双向关联，但其中一个类不使用另一个类的功能。

## 解决方案

删除未使用的关联。

### 重构前
![Change Bidirectional Association to Unidirectional - Before](link-to-image-before)

### 重构后
![Change Bidirectional Association to Unidirectional - After](link-to-image-after)

## 为何要进行重构

通常，双向关联比单向关联更难维护，需要额外的代码来正确创建和删除相关对象。这使得程序更加复杂。

此外，不正确实现的双向关联可能导致垃圾回收问题（进而导致未使用的对象引起的内存膨胀）。

例如：垃圾收集器会从内存中删除不再被其他对象引用的对象。假设创建、使用，然后丢弃了用户-订单对象对。但由于它们仍相互引用，这些对象将不会从内存中清除。尽管如此，由于编程语言的进步，现在可以自动识别未使用的对象引用并将其从内存中删除，这个问题变得不那么重要了。

还有类之间的相互依赖问题。在双向关联中，这两个类必须了解对方，这意味着它们不能分开使用。如果存在许多这样的关联，程序的不同部分将过于依赖于彼此，对一个组件的任何更改可能会影响其他组件。

## 优势

简化了不需要该关系的类。更少的代码意味着更少的代码维护。

减少了类之间的依赖关系。独立的类更容易维护，因为对类的任何更改仅影响该类。

## 如何进行重构

确保对于您的类之一，以下情况之一为真：

1. 未使用关联。
2. 有另一种方法可以获取关联对象，例如通过数据库查询。
3. 关联对象可以作为参数传递给使用它的方法。

根据您的情况，包含与另一个对象关联的字段的使用应该被替换为通过不同方式获取对象的参数或方法调用。

1. 删除将关联对象分配给字段的代码。

2. 删除现在未使用的字段。