# 重构：将单向关联改为双向关联

## 问题

有两个类，它们都需要使用对方的功能，但它们之间的关联只是单向的。

## 解决方案

在需要的类中添加缺失的关联。

### 重构前
![Change Unidirectional Association to Bidirectional - Before](link-to-image-before)

### 重构后
![Change Unidirectional Association to Bidirectional - After](link-to-image-after)

## 为何要进行重构

最初，这两个类之间存在单向关联。但随着时间的推移，客户端代码需要访问关联的两侧。

## 优势

- 如果一个类需要反向关联，可以简单地计算它。但如果这些计算很复杂，最好保留反向关联。
  
## 缺点

- 双向关联比单向关联更难实现和维护。
  
- 双向关联使类之间产生相互依赖。对于单向关联，其中一个类可以独立于另一个类使用。

## 如何进行重构

1. 添加一个用于保存反向关联的字段。

2. 决定哪个类将是“主导”类。这个类将包含创建或更新关联的方法，当元素被添加或更改时，在其类中建立关联，并调用用于在关联对象中建立关联的实用方法。

3. 为在“非主导”类中建立关联创建一个实用方法。该方法应使用参数中提供的内容来完成字段。为方法取一个明显的名称，以便以后不会用于其他目的。

4. 如果在“主导”类中有用于控制单向关联的旧方法，请通过调用与关联对象相关的实用方法来补充它们。

5. 如果在“非主导”类中有用于控制关联的旧方法，请在“主导”类中创建这些方法，调用它们，并将执行委托给它们。