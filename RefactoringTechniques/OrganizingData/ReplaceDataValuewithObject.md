# 用对象替换数据值

## 问题

一个类（或一组类）包含一个数据字段。该字段具有自己的行为和相关数据。

## 解决方案

创建一个新类，将旧字段及其行为放入该类，并将该类的对象存储在原始类中。


## 为何要进行重构

这种重构基本上是“提取类”的一种特殊情况。不同之处在于重构的原因。

在“提取类”中，我们有一个负责不同事物的单个类，我们希望分割其责任。

而在用对象替换数据值的情况下，我们有一个原始的基本字段（数字、字符串等），由于程序的增长，它不再那么简单，并且现在具有相关的数据和行为。从某种程度上说，这些字段本身并没有什么可怕的地方。然而，这个字段和行为的组合可能同时存在于多个类中，从而创建重复的代码。

因此，为了解决这个问题，我们创建一个新类，将字段以及相关的数据和行为移至其中。

## 优势

改进了类内部的关联性。数据和相关行为都在一个类中。

## 如何进行重构

1. 在进行重构之前，请查看类内部是否直接引用了该字段。如果有，请使用“自我封装字段”来隐藏它在原始类中。

2. 创建一个新类，并将字段及其相关的 getter 复制到新类中。此外，创建一个构造函数，接受字段的简单值作为参数。该类不会有 setter，因为每个发送到原始类的新字段值都将创建一个新的值对象。

3. 在原始类中，将字段类型更改为新类。

4. 在原始类的 getter 中，调用关联对象的 getter。

5. 在 setter 中，创建一个新的值对象。如果之前在构造函数中为字段设置了初始值，可能还需要在构造函数中创建一个新对象。

## 下一步

在应用了这种重构技术之后，建议对包含该对象的字段应用“将值改为引用”。这样可以存储对一个与值相对应的单个对象的引用，而不是为相同的值存储大量对象。

通常，在想要一个对象负责一个真实世界对象（例如用户、订单、文档等）的情况下，这种方法是有用的。与此同时，对于诸如日期、货币、范围等对象，这种方法可能不太适用。