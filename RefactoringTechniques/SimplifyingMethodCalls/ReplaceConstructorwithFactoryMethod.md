# 用工厂方法替换构造函数

## 问题

你有一个复杂的构造函数，它做的事情不仅仅是在对象字段中设置参数值。

## 解决方案

创建一个工厂方法并使用它来替代构造函数的调用。

```java
// 改前
class Employee {
  Employee(int type) {
    this.type = type;
  }
  // ...
}
```

```
// 改后
class Employee {
  static Employee create(int type) {
    employee = new Employee(type);
    // 进行一些复杂的操作。
    return employee;
  }
  // ...
}
```

## 为什么重构

使用这种重构技术的最明显的原因与使用子类替换类型码有关。

你有一个代码，以前创建了一个对象，并将编码类型的值传递给它。在使用重构方法之后，出现了几个子类，你需要根据编码类型的值创建对象。更改原始构造函数使其返回子类对象是不可能的，因此我们创建了一个静态工厂方法，该方法将返回必要类的对象，然后替换所有对原始构造函数的调用。

工厂方法在其他情况下也可以使用，当构造函数无法完成任务时。当尝试将值更改为引用时，它们可能很重要。它们还可以用于设置超出参数的数量和类型的各种创建模式。

## 优势

工厂方法不一定返回在其调用的类中的对象。通常情况下，根据传递给该方法的参数，它们可能是其子类。

工厂方法可以有一个更好的名称，描述它返回什么以及它是如何返回的，例如 `Troops::GetCrew(myTank)`。

工厂方法可以返回已经创建的对象，而构造函数总是创建一个新实例。

## 如何重构

1. 创建一个工厂方法。在其中调用当前的构造函数。

2. 将所有构造函数调用替换为对工厂方法的调用。

3. 将构造函数声明为私有。

4. 调查构造函数代码，尝试将与创建当前类对象直接相关的代码隔离出来，将这样的代码移到工厂方法中。