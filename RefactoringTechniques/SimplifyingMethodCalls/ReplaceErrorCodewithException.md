# 将错误代码替换为异常

## 问题
一个方法返回一个特殊值，表示出现了错误？

## 解决方案
改为抛出异常。

### Java
```java
int withdraw(int amount) {
  if (amount > _balance) {
    return -1;
  }
  else {
    balance -= amount;
    return 0;
  }
}
```
```
void withdraw(int amount) throws BalanceException {
  if (amount > _balance) {
    throw new BalanceException();
  }
  balance -= amount;
}
```

## 为什么重构
返回错误代码是过时的过程式编程的剩余物。在现代编程中，错误处理是由特殊的类执行的，这些类称为异常。如果出现问题，您会“抛出”一个错误，然后由异常处理程序“捕获”它。特殊的错误处理代码在正常条件下被忽略，只有在异常情况下才会被激活。

## 优势
- 使代码摆脱大量用于检查各种错误代码的条件语句。异常处理程序是一个更简洁的方式，用于区分正常执行路径和异常路径。
- 异常类可以实现自己的方法，从而包含部分错误处理功能（例如发送错误消息）。
- 与异常不同，错误代码无法在构造函数中使用，因为构造函数必须只返回一个新对象。

## 缺点
异常处理程序可能变成类似于goto的支架。要避免这种情况！不要使用异常来管理代码执行。异常只应该在发生错误或关键情况时抛出。

## 如何重构
尝试一次只执行一个错误代码的这些重构步骤。这将使得更容易记住所有重要信息，并避免错误。

1. 找到调用返回错误代码的方法的所有调用，并在try/catch块中包装它，而不是检查错误代码。
2. 在方法内部，不要返回错误代码，而是抛出异常。
3. 更改方法签名，使其包含有关抛出异常的信息（@throws 部分）。