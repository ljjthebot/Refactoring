# 用查询替换临时变量（Replace Temp with Query）

## 问题
将表达式的结果存储在本地变量中，以备将来在代码中使用。

## 解决方案
将整个表达式移到一个单独的方法中，并从中返回结果。在代码中使用该方法查询结果，而不使用变量。必要时将新方法合并到其他方法中。


```
def calculateTotal():
    basePrice = quantity * itemPrice
    if basePrice > 1000:
        return basePrice * 0.95
    else:
        return basePrice * 0.98
```

```
def calculateTotal():
    if basePrice() > 1000:
        return basePrice() * 0.95
    else:
        return basePrice() * 0.98

def basePrice():
    return quantity * itemPrice
```


# 为何进行重构

这种重构可以为在一个非常长的方法中的某个部分应用“提取方法”打下基础。

同样的表达式有时可能在其他方法中找到，这是考虑创建一个通用方法的原因之一。

## 好处

- 代码可读性。理解方法 `getTax()` 的目的比理解 `orderPrice() * 0.2` 这一行要容易得多。

- 通过去重，代码更简洁，如果被替换的行在多个方法中使用。

## 需要知道

### 性能

这种重构可能会引发一个问题，即这种方法是否会导致性能损失。诚实的答案是：是的，它可能会，因为生成的代码可能会因为查询新方法而负担重担。但是在今天快速的 CPU 和出色的编译器的情况下，这种负担几乎总是微不足道的。相比之下，通过这种重构方法实现的可读代码以及能够在程序代码的其他地方重用此方法的能力是非常明显的好处。

然而，如果你的临时变量用于缓存一个确实耗时的表达式的结果，那么在将表达式提取到新方法后，你可能希望停止这种重构。

## 如何进行重构

1. 确保在方法中只有一次对变量进行赋值。如果不是，请使用“分割临时变量”确保该变量仅用于存储表达式的结果。

2. 使用“提取方法”将感兴趣的表达式放入一个新方法中。确保该方法仅返回一个值，不改变对象的状态。如果方法影响对象的可见状态，请使用“将查询函数与修改函数分离”。

3. 用对新方法的查询替换变量。
